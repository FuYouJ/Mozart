## DataX HdfsReader 源码分析，及空文件 Bug修复和路径正则功能增强

### **概述**

- 当我们使用 DataX 的 hdfsreader 时直接配置读取的HDFS 目录后，如果此目录下存在空文件时会报异常，针对此问题，本文档将详细介绍此问题的处理，并同时给也给出基于源码的bug 修复方案。
- 当我们配置的 path 使用 范围正则形式时报错，针对源码中未支持的此部分功能进行源码层面的完善

### 问题描述

例如当 HDFS 的需要读取数据的文件夹下有存在一个大小为0空文件时，并且此时在hdfsreader的path配置的为此目录（而非正则化路径）时会报如下的错误，具体报错信息后面会通过问题复现来观察，大概是在验证指定目录的文件类型时报了异常，文件 000000_01 验证为 ORC 类型符合预期要求添加到了 source file 列表中，当继续获取指定目录下的 000001_01 时类型验证失败，抛出了异常，但是通过查看 HDFS 上次文件，这个文件的大小为 0。

![img](http://www.xiewenshi.fans/blogimg/datax/dataxError.png)